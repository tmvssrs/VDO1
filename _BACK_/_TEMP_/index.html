
<!DOCTYPE html>
<html>
    <head>
        <link href="css/opmaak.css" rel="stylesheet">
        <meta charset="utf-8">
        <title>Puntentabel</title>
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS"
        crossorigin="anonymous">
    </head>
    <body>
        
        <div class="container">
            <div id="demo"></div>
        </div>  
    
<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
    crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js" integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
    crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js" integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
    crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-3.3.1.js" integrity="sha256-2Kok7MbOyxpgUVvAk/HJ2jigOSYS2auK4Pfzbm7uH60="
    crossorigin="anonymous"></script>
<script>

// let xhttp;
let arr1,
    arr2,
    arr3;

function displayStudentsColumn(){
    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            arr1 = JSON.parse(this.responseText);
            // console.log(arr1);
            // createTable(arr1, arr2, arr3);
            displayMistakes();
        }
    }
    xhttp.open("GET","http://localhost:7777/students", true);
    xhttp.send();
}


function displayMistakes(){
    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            arr2 = JSON.parse(this.responseText);
            // console.log(arr2);
            // createTable(arr1, arr2, arr3);
            displaySelect()
        }
    }
    xhttp.open("GET","http://localhost:7777/mistakes", true);
    xhttp.send();
}


function displaySelect(){
    let xhttp = new XMLHttpRequest();
    xhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
            arr3 = JSON.parse(this.responseText);
            createTable(arr1, arr2, arr3);
        }
    }
    xhttp.open("GET","http://localhost:7777/disciplines", true);
    xhttp.send();
}


function createTable(arr1, arr2, arr3){
    let table =
        '<table id="puntentabel">' +
            '<thead>' +
                '<td id="cornerLU">' +
                    '<button onclick="addCol()" id="addcol">add column</button>' +
                    '<button onclick="remCol()" id="remcol">remove column</button>' +
                    '<select id="rounded" class="custom-select">' +
                        '<option value="0">Select Course</option>';
                        for (x in arr3) {
                            table += '<option>' + arr3[x].vak_naam + '</option>';
                        }
                        table += '</select>'+
                        '</td>';
                        for (x in arr2) {
                            table += '<td class="fouten"><div class="rotate"><p>' + arr2[x].fou_omschrijving + '</p></div></td>';
                        }
                        table +='<td id="result">Result</td>'+
                                '</thead>';
                        for (x in arr1) {
                            table += '<tr class="student"><td>' + arr1[x].stu_voornaam + ' ' + arr1[x].stu_naam + '</td>';
                            for (y in arr2){
                                table += '<td><input type="checkbox" name="' + arr2[y].fou_omschrijving + '"></td>';
                            }
                        table +='<td>'+
                                '</td>'+
                                '</tr>';
                        }
    table +='</table>';
    document.getElementById("demo").innerHTML = table;
}
    displayStudentsColumn();
    //displayMistakes();
    //displaySelect();
    //createTable(arr1, arr2, arr3);

    function remCol(){
        let tbl = document.getElementById("puntentabel"),
                    i,
                    nrCells = tbl.rows[1].cells.length;

        if (nrCells > 2){
            for (i=0; i<tbl.rows.length;i++){
                // alert(nrCells);
                tbl.rows[i].deleteCell(nrCells -2);
            }
        } else{
            alert("Deze kolommen moeten blijven staan!")
        }
    };

    function addCol(){
        // append column to the HTML table
        var tbl = document.getElementById('puntentabel'), // table reference
            i;
        // open loop for each row and append cell
        for (i = 0; i < tbl.rows.length; i++) {
            createCell(tbl.rows[i].insertCell(tbl.rows[i].cells.length-1), i);
        }
    }
            // create DIV element and append to the table cell
    function createCell(cell, text) {
        if (text == 0){
            fout = prompt("Voeg een fout toe: ");
            var newElement = document.createElement("p");
            newElement.setAttribute("class", "rotate");
            // newElement.style("background","rgb(7, 77, 33)");
            var foutTxt = document.createTextNode(fout);
            newElement.appendChild(foutTxt);
            cell.setAttribute("class", "fouten");
        } else{
            var newElement = document.createElement("input");
            newElement.setAttribute("type", "checkbox");
            newElement.setAttribute("name", fout);
        }
        cell.insertBefore(newElement, cell.childNodes[0]);
    }



    // Get the form.
    const form = $('#main_contact_form');

    // Get the messages div.
    const formMessages = $('#success_fail_info');

    // Set up an event listener for the contact form.
    // $(form).submit(function (e) {
        // Stop the browser from submitting the form.
        // console.log("...");
        // e.preventDefault();

        // Serialize the form data.
        // let formData = $(form).serialize();

        // Submit the form using AJAX.
        // $.post( $(form).attr('action'), formData)
        // .done( (response)=> {
        //     addCol();
        //     createCell();
            // Set the message text.
            // $(formMessages).text('Thanks! Mistake added.');
            // Make sure that the formMessages div has the 'success' class.
        //     $(formMessages).removeClass('error');
        //     $(formMessages).addClass('success');
        // })
        // .fail((data)=> {
        // // Make sure that the formMessages div has the 'error' class.
        //     $(formMessages).removeClass('success');
        //     $(formMessages).addClass('error');
        //     $(formMessages).text('Oops! An error occured.');
        // }
    // })



</script>
 
</body>
</html>
