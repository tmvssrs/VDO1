<!DOCTYPE html>
<html>
    <head>
        <link href="css/opmaak.css" rel="stylesheet">
        <meta charset="utf-8">
        <title>Puntentabel</title>
    </head>
    <body>

        
    <div id="test">

    </div>

    
    
    </body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script>
        
        let myObj;
        let i;
        let ii;
        let array_vakken = Array();
        let array_fouten = Array();
        let array_students = Array();

        function tableVakken(callback){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (vak in myObj) {
                        array_vakken.push(myObj[vak]);
                    }
                }
            }
            xhttp.open("GET", "http://localhost:1777/vakken", true);
            xhttp.send();
        } // end function tableVakken

        function tableFouten(callback){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (fout in myObj) {
                        array_fouten.push(myObj[fout]);
                    }
                    callback(array_fouten);
                }
            }
            xhttp.open("GET", "http://localhost:1777/fouten", true);
            xhttp.send();
        } // end function tableFouten

        function tableStudenten(callback){
            let xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (student in myObj) {
                        array_students.push(myObj[student]);
                    }
                }

            }
            xhttp.open("GET", "http://localhost:1777/students", true);
            xhttp.send();
        } // end function tableStudenten


        function callbackFouten(x){
            let table = 
            '<table id="puntentabel">'+
            '<button onclick="addCol()" id="addcol">add column</button>'+
            '<button onclick="remCol()" id="remcol">remove column</button>'+
            '<thead>'+
            '<td id="cornerLU">'+
            '<div class="custom-select">'+
            '<select id="rounded">'+
            '<option value="0">Select Course</option>';
            for (i=0;i<array_vakken.length;i++){
                table += '<option value="'+ (i + 1) +'">'+ array_vakken[i].vak_naam +'</option>';
            }
            table += 
                    '</select>'+
                    '</div>'+
                    '</td>';
            for (i=0;i<array_fouten.length;i++){
                table += '<td class="fouten"><div class="rotate"><p>'+ array_fouten[i].fou_omschrijving +'</p></div></td>';
            }
            table += 
                    '<td id="result">Result</td>'+
                    '</thead>';
            for (i=0;i<array_students.length;i++){
                table += 
                    '<tr class="student"><td>'+ array_students[i].stu_voornaam +' '+ array_students[i].stu_naam +'</td>';
                for (ii = 0;ii<array_fouten.length; ii++){
                    table += '<td><input type="checkbox" name="'+ array_fouten[ii].fou_omschrijving +'"></td>';
                }
                table += '<td></td></tr>';
            }
            table += '</table>';


            document.getElementById("test").innerHTML = table;
        };


        tableStudenten();
        tableVakken();
        tableFouten(callbackFouten);

        

            function remCol(){
                    let tbl = document.getElementById("puntentabel"),
                    i,
                    nrCells = tbl.rows[1].cells.length;
        
                    if (nrCells > 2){
                        for (i=0; i<tbl.rows.length;i++){
                            // alert(nrCells);
                            tbl.rows[i].deleteCell(nrCells -2);
                        }
                    } else{
                        alert("Deze kolommen moeten blijven staan!")
                    }
                    
            };
        
            function addCol(){
                // append column to the HTML table
                var tbl = document.getElementById('puntentabel'), // table reference
                    i;
                // open loop for each row and append cell
                for (i = 0; i < tbl.rows.length; i++) {
                    createCell(tbl.rows[i].insertCell(tbl.rows[i].cells.length-1), i);
                }
            }
            // create DIV element and append to the table cell
        function createCell(cell, text) {
            if (text == 0){
                fout = prompt("Voeg een fout toe: ");
                var newElement = document.createElement("p");
                newElement.setAttribute("class", "rotate");
                var foutTxt = document.createTextNode(fout);
                newElement.appendChild(foutTxt);
                cell.setAttribute("class", "fouten");
            } else{
                var newElement = document.createElement("input");
                newElement.setAttribute("type", "checkbox");
                newElement.setAttribute("name", fout);
            }
            cell.insertBefore(newElement, cell.childNodes[0]);
            // let sql = "INSERT INTO fouten SET fou_omschrijving = '"+ text +"' , fou_minpunten = 1;"
            // $.get("/sql", (req,res)=>{res.send([text])});
        }
        
        
        
        
            </script>
</html>