<!DOCTYPE html>
<html>
    <head>
        <link href="css/opmaak.css" rel="stylesheet">
        <meta charset="utf-8">
        <title>Puntentabel</title>
    </head>
    <body>

        
    <div id="test">

    </div>

    
    
    </body>
    <script>
        let xhttp = new XMLHttpRequest();
        let myObj;
        let i;
        function tableVakken(){
            let txtvakken = '<table id="puntentabel">'+
                        '<button onclick="addCol()" id="addcol">add column</button>'+
                        '<button onclick="remCol()" id="remcol">remove column</button>'+
                        '<thead>'+
                        '<td id="cornerLU">'+
                        '<div class="custom-select">'+
                        '<select id="rounded">'+
                        '<option value="0">Select Course</option>';

            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (vak in myObj) {
                        txtvakken += '<option value="'+i+'">'+myObj[vak].vak_naam+'</option>'
                        i++          
                    }
                    txtvakken += '</select></div></td>';
                    num = 2;
                    printTable(txtvakken);
                }
            }
            xhttp.open("GET", "http://localhost:1777/vakken", true);
            xhttp.send();
        } // end function tableVakken

        function tableFouten(){
            let txtfouten = "";
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (fouten in myObj) {
                        txtfouten += '<td class="fouten"><div class="rotate"><p>'+myObj[fouten].fou_omschrijving+'</p></div></td>';
                    }
                    txtfouten += '<td id="result">Result</td></thead>';
                    num = 3;
                    printTable(txtfouten);
                }
            }
            xhttp.open("GET", "http://localhost:1777/fouten", true);
            xhttp.send();
        } // end function tableFouten

        function tableStudenten(){
            let txtstudenten = "";
            xhttp.onreadystatechange = function() {
                if (this.readyState == 4 && this.status == 200) {
                // Typical action to be performed when the document is ready:
                    let x = JSON.parse(this.responseText);
                    myObj = JSON.parse(x);
                    for (student in myObj) {
                        txtstudenten += 
                        "<tr class='student'>"+
                        "<td>"+ myObj[student].stu_voornaam + " " + myObj[student].stu_naam + "</td>"+
                        "<td><input type='checkbox' name='fout1'></td>"+
                        "<td><input type='checkbox' name='fout2'></td>"+
                        "<td><input type='checkbox' name='fout3'></td>"+
                        "<td><input type='checkbox' name='fout4'></td>"+
                        "<td></td>"+
                        "</tr>";
                    }
                    txtstudenten += "</table>";
                    num = 4;
                    printTable(txtstudenten);
                }

            }
            xhttp.open("GET", "http://localhost:1777/students", true);
            xhttp.send();
        }

        let num = 0;
        let fulltable = "";
        function printTable(respons){
            if (num == 0){ num = 1; } 
            else { fulltable += respons; }
            if (num == 1){ tableVakken(); }
            if (num == 2){ tableFouten(); }
            if (num == 3){ tableStudenten(); }
            if (num == 4){
                document.getElementById("test").innerHTML = fulltable;
            }
            
        } // end function printTable
        printTable();


            function remCol(){
                    let tbl = document.getElementById("puntentabel"),
                    i,
                    nrCells = tbl.rows[1].cells.length;
        
                    if (nrCells > 2){
                        for (i=0; i<tbl.rows.length;i++){
                            // alert(nrCells);
                            tbl.rows[i].deleteCell(nrCells -2);
                        }
                    } else{
                        alert("Deze kolommen moeten blijven staan!")
                    }
                    
            };
        
            function addCol(){
                // append column to the HTML table
                var tbl = document.getElementById('puntentabel'), // table reference
                    i;
                // open loop for each row and append cell
                for (i = 0; i < tbl.rows.length; i++) {
                    createCell(tbl.rows[i].insertCell(tbl.rows[i].cells.length-1), i);
                }
            }
            // create DIV element and append to the table cell
        function createCell(cell, text) {
            if (text == 0){
                fout = prompt("Voeg een fout toe: ");
                var newElement = document.createElement("p");
                newElement.setAttribute("class", "rotate");
                // newElement.style("background","rgb(7, 77, 33)");
                var foutTxt = document.createTextNode(fout);
                newElement.appendChild(foutTxt);
                cell.setAttribute("class", "fouten");
            } else{
                var newElement = document.createElement("input");
                newElement.setAttribute("type", "checkbox");
                newElement.setAttribute("name", fout);
            }
            cell.insertBefore(newElement, cell.childNodes[0]);
        }
        
        
        
        
            </script>
</html>